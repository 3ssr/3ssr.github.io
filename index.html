<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="记录打怪升级之路">
<meta property="og:type" content="website">
<meta property="og:title" content="个人博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="个人博客">
<meta property="og:description" content="记录打怪升级之路">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="个人博客">
<meta name="twitter:description" content="记录打怪升级之路">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>个人博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/26/2019-08-26-Kafka的基本命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="嘿嘿嘿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://s2.ax1x.com/2019/08/14/mFInYj.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/26/2019-08-26-Kafka的基本命令/" itemprop="url">Kafka的基本命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-26T00:00:00+08:00">
                2019-08-26
              </time>
            

            

            
          </span>

          

          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  283
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="脚本命令使用"><a href="#脚本命令使用" class="headerlink" title="脚本命令使用"></a>脚本命令使用</h2><h3 id="生产消息"><a href="#生产消息" class="headerlink" title="生产消息"></a>生产消息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./kafka-console-producer.sh --broker-list kafkas:9092 --topic user_register</span><br></pre></td></tr></table></figure>

<p>输入消息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;accountname&quot;:&quot;test@qq.com&quot;,&quot;action&quot;:&quot;register&quot;,&quot;appname&quot;:&quot;CoolLine&quot;,&quot;appversion&quot;:&quot;1.6.xx&quot;,&quot;channelName&quot;:&quot;googleplay&quot;,&quot;cityen&quot;:&quot;&quot;,&quot;cityzh&quot;:&quot;&quot;,&quot;continentsen&quot;:&quot;&quot;,&quot;continentszh&quot;:&quot;&quot;,&quot;countryen&quot;:&quot;&quot;,&quot;countryZh&quot;:&quot;美国&quot;,&quot;createTimestamp&quot;:1566376441,&quot;deviceid&quot;:&quot;edb3d8ce8df595ad&quot;,&quot;isPrivilegedUser&quot;:&quot;true&quot;,&quot;line&quot;:&quot;CoolLine&quot;,&quot;mail&quot;:&quot;test@qq.com&quot;,&quot;pkgname&quot;:&quot;cc.coolline.client&quot;,&quot;platform&quot;:&quot;Android&quot;,&quot;provinceen&quot;:&quot;&quot;,&quot;provincezh&quot;:&quot;&quot;,&quot;pt&quot;:&quot;2019-08-21&quot;,&quot;registerip&quot;:&quot;10.244.2.64&quot;,&quot;registertime&quot;:&quot;2019-08-21 16:34:01&quot;,&quot;registertype&quot;:&quot;mail&quot;,&quot;userid&quot;:19348,&quot;userName&quot;:&quot;test@qq.com&quot;,&quot;userpwd&quot;:&quot;86A8F132223D033619389988E663F6C2&quot;,&quot;userstate&quot;:0,&quot;virtualCountryCode&quot;:&quot;AF&quot;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="消费主题"><a href="#消费主题" class="headerlink" title="消费主题"></a>消费主题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./kafka-console-consumer.sh --bootstrap-server kafkas:9092 --topic user_register --from-beginning</span><br></pre></td></tr></table></figure>

<h3 id="设置某个主题的消息缓存时间"><a href="#设置某个主题的消息缓存时间" class="headerlink" title="设置某个主题的消息缓存时间"></a>设置某个主题的消息缓存时间</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./kafka-configs.sh --zookeeper zookeeper:2181 --alter --entity-name $&#123;主题&#125; --entity-type topics --add-config retention.ms=86400000</span><br></pre></td></tr></table></figure>

<h3 id="立即生效"><a href="#立即生效" class="headerlink" title="立即生效"></a>立即生效</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./kafka-topics.sh --zookeeper zookeeper:2181 --alter --topic $&#123;主题&#125; --config cleanup.policy=delete</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/19/2019-08-19-网络检查工具 tcpdump 的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="嘿嘿嘿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://s2.ax1x.com/2019/08/14/mFInYj.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/19/2019-08-19-网络检查工具 tcpdump 的使用/" itemprop="url">网络检查工具 tcpdump 的使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-19T00:00:00+08:00">
                2019-08-19
              </time>
            

            

            
          </span>

          

          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  0
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/15/2019-08-16-Linux下统计代码的工具Cloc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="嘿嘿嘿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://s2.ax1x.com/2019/08/14/mFInYj.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/15/2019-08-16-Linux下统计代码的工具Cloc/" itemprop="url">Linux下统计代码的工具Cloc</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-15T00:00:00+08:00">
                2019-08-15
              </time>
            

            

            
          </span>

          

          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  161
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Cloc"><a href="#Cloc" class="headerlink" title="Cloc"></a>Cloc</h2><p>cloc是linux平台里可以统计代码的工具，并非简单的统计代码的行数，能同时针对各种语言做分类输出</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install cloc</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cloc $filePath</span><br></pre></td></tr></table></figure>

<p>返回结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ cloc .</span><br><span class="line">    1339 text files.</span><br><span class="line">    1302 unique files.                                          </span><br><span class="line">     160 files ignored.</span><br><span class="line"></span><br><span class="line">github.com/AlDanial/cloc v 1.74  T=3.75 s (321.1 files/s, 135799.4 lines/s)</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Language                      files          blank        comment           code</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Go                              940          39122          40781         354176</span><br><span class="line">C                                37           6806           9795          31924</span><br><span class="line">Markdown                         49           1854              0           6552</span><br><span class="line">C/C++ Header                     37           1330           3531           3864</span><br><span class="line">Assembly                         38            503            884           2402</span><br><span class="line">YAML                             70            145             18           1955</span><br><span class="line">Bourne Shell                     13            139            323            856</span><br><span class="line">JSON                              1              2              0            637</span><br><span class="line">make                              9             73             96            296</span><br><span class="line">Protocol Buffers                  3             38             27            165</span><br><span class="line">SQL                               1              1              0            155</span><br><span class="line">Python                            1             14             13             99</span><br><span class="line">Bourne Again Shell                1              8              3             52</span><br><span class="line">TOML                              2              5             45             11</span><br><span class="line">Dockerfile                        1              1              0              8</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">SUM:                           1203          50041          55516         403152</span><br><span class="line">--------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/15/2019-08-15-k8s踩坑集锦/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="嘿嘿嘿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://s2.ax1x.com/2019/08/14/mFInYj.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/15/2019-08-15-k8s踩坑集锦/" itemprop="url">k8s踩坑集锦</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-15T00:00:00+08:00">
                2019-08-15
              </time>
            

            

            
          </span>

          

          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  373
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="踩坑集锦"><a href="#踩坑集锦" class="headerlink" title="踩坑集锦"></a>踩坑集锦</h2><p>此篇文章用来记录维护k8s过程中的一系列问题</p>
<hr>
<h3 id="kubectl-logs-超时"><a href="#kubectl-logs-超时" class="headerlink" title="kubectl logs 超时"></a>kubectl logs 超时</h3><p>错误类似：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error from server: Get https://172.31.27.3:10250/containerLogs/prod-sfox/a-group-miner-2hshz/miner-idx-1?follow=true&amp;tailLines=20: dial tcp 172.31.27.3:10250: connect: connection timed out</span><br></pre></td></tr></table></figure>

<ul>
<li><p>该操作走内网ip，节点间内网不同</p>
</li>
<li><p>10250端口未打开</p>
</li>
</ul>
<hr>
<h3 id="DNS解析失败"><a href="#DNS解析失败" class="headerlink" title="DNS解析失败"></a>DNS解析失败</h3><p>具体错误信息一般如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">panic: dial tcp: lookup mysql on 10.96.0.10:53: no such host</span><br></pre></td></tr></table></figure>

<ul>
<li><p>查看coredns的日志，判断集群内的dns解析是否成功</p>
</li>
<li><p>如果集群内成功，是往外网的dns解析出错，检查宿主机的 <code>/etc/resolv.conf</code> 配置</p>
</li>
</ul>
<hr>
<h3 id="Helm报错"><a href="#Helm报错" class="headerlink" title="Helm报错"></a>Helm报错</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPGRADE FAILED</span><br><span class="line">Error: &quot;dev-chain&quot; has no deployed releases</span><br><span class="line">Error: UPGRADE FAILED: &quot;dev-chain&quot; has no deployed releases</span><br></pre></td></tr></table></figure>

<p>原因是helm的bug，如果helm有一次deploy的失败记录就没法重新deploy, 需要手动通过 <code>helm delete</code> 命令删除错误的记录</p>
<hr>
<h3 id="容器组里的服务获取不到客户端真实IP"><a href="#容器组里的服务获取不到客户端真实IP" class="headerlink" title="容器组里的服务获取不到客户端真实IP"></a>容器组里的服务获取不到客户端真实IP</h3><p>如果你的服务暴露方式是NodePort，当客户端访问IP所属的Node和服务所在的Node不是同一个Node时，因为内部有SNAT和DNAT的存在，<br>客户端的源IP会丢失，解决方法，在Service的配置中添加 <code>externalTrafficPolicy</code>, 并用 <code>nodeSelector</code> 将pod固定在nodePort对应的同一台机器上</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">signal</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  externalTrafficPolicy:</span> <span class="string">Local</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">http</span></span><br><span class="line"><span class="attr">      nodePort:</span> <span class="number">30010</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">signal</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="公用解决方法"><a href="#公用解决方法" class="headerlink" title="公用解决方法"></a>公用解决方法</h3><ul>
<li><p>查看kubelet日志</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl status kubelet</span><br><span class="line">journalctl -xu kubelet</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看docker的日志</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl status docker</span><br><span class="line">journalctl -xu docker</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/15/2019-08-15-Shell里的变量取值/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="嘿嘿嘿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://s2.ax1x.com/2019/08/14/mFInYj.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/15/2019-08-15-Shell里的变量取值/" itemprop="url">Shell取值表达式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-15T00:00:00+08:00">
                2019-08-15
              </time>
            

            

            
          </span>

          

          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  292
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Shell里的变量取值"><a href="#Shell里的变量取值" class="headerlink" title="Shell里的变量取值"></a>Shell里的变量取值</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 假如 $file 没有设定，则使用 my.file.txt 作传回值。(空值及非空值时不作处理) </span><br><span class="line">$&#123;file-my.file.txt&#125;</span><br><span class="line"></span><br><span class="line"># 假如 $file 没有设定或为空值，则使用 my.file.txt 作传回值。 (非空值时不作处理)</span><br><span class="line">$&#123;file:-my.file.txt&#125;</span><br><span class="line"></span><br><span class="line"># 假如 $file 设为空值或非空值，均使用 my.file.txt 作传回值。(没设定时不作处理)</span><br><span class="line">$&#123;file+my.file.txt&#125; </span><br><span class="line"></span><br><span class="line"># 若 $file 为非空值，则使用 my.file.txt 作传回值。 (没设定及空值时不作处理)</span><br><span class="line">$&#123;file:+my.file.txt&#125;</span><br><span class="line"></span><br><span class="line"># 若 $file 没设定，则使用 my.file.txt 作传回值，同时将 $file 赋值为 my.file.txt 。 (空值及非空值时不作处理)</span><br><span class="line">$&#123;file=my.file.txt&#125; </span><br><span class="line"></span><br><span class="line"># 若 $file 没设定或为空值，则使用 my.file.txt 作传回值，同时将 $file 赋值为 my.file.txt 。 (非空值时不作处理)</span><br><span class="line">$&#123;file:=my.file.txt&#125;</span><br><span class="line"></span><br><span class="line"># 若 $file 没设定，则将 my.file.txt 输出至 STDERR。 (空值及非空值时不作处理)</span><br><span class="line">$&#123;file?my.file.txt&#125;</span><br><span class="line"></span><br><span class="line"># 若 $file 没设定或为空值，则将 my.file.txt 输出至 STDERR。 (非空值时不作处理)</span><br><span class="line">$&#123;file:?my.file.txt&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/14/Docker-杂记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="嘿嘿嘿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://s2.ax1x.com/2019/08/14/mFInYj.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/14/Docker-杂记/" itemprop="url">Docker 杂记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-14T15:48:18+08:00">
                2019-08-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  0
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/14/2019-08-14-NodeJS与ES6的模块化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="嘿嘿嘿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://s2.ax1x.com/2019/08/14/mFInYj.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/14/2019-08-14-NodeJS与ES6的模块化/" itemprop="url">NodeJS与ES6的模块化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-14T00:00:00+08:00">
                2019-08-14
              </time>
            

            

            
          </span>

          

          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  399
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="NodeJS的module"><a href="#NodeJS的module" class="headerlink" title="NodeJS的module"></a>NodeJS的module</h2><p>对于 <code>circle.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这种导出方式，相当于将变量地址导出，会被外界修改</span></span><br><span class="line">exports.varA = <span class="string">'varA'</span></span><br><span class="line"></span><br><span class="line">exports.func1 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'func1'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.varB = <span class="string">'varB'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以上写法等价于</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  varA: <span class="string">'varA'</span>,</span><br><span class="line">  varB: <span class="string">'varB'</span>,</span><br><span class="line">  func1 () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'func'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>main.js</code> 中可以这么引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> math = <span class="built_in">require</span>(<span class="string">'./utils/math'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(math.varA)</span><br><span class="line"><span class="built_in">console</span>.log(math.varB)</span><br><span class="line">math.func1()</span><br><span class="line"></span><br><span class="line">math.varA = <span class="string">'A'</span>;</span><br><span class="line">math.varB = <span class="string">'B'</span>;</span><br><span class="line">math.func1 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'another func'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> math2 = <span class="built_in">require</span>(<span class="string">'./utils/math'</span>)</span><br><span class="line"><span class="comment">// varA, varB 和 func1 都发生了改变，证明import进来的模块是单例的</span></span><br><span class="line"><span class="built_in">console</span>.log(math2.varA)</span><br><span class="line"><span class="built_in">console</span>.log(math2.varB)</span><br><span class="line">math2.func1()</span><br></pre></td></tr></table></figure>

<h2 id="ES6的module"><a href="#ES6的module" class="headerlink" title="ES6的module"></a>ES6的module</h2><p>ES6 模块不是对象，而是通过export命令显式指定输出的代码，再通过import命令输入。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; stat, exists, readFile &#125; <span class="keyword">from</span> <span class="string">'fs'</span>;</span><br></pre></td></tr></table></figure>

<p>上面代码的实质是从fs模块加载3个方法，其他方法不加载。这种加载称为“编译时加载”或者静态加载，即 ES6 可以在编译时就完成模块加载，效率要比 CommonJS 模块的加载方式高。当然，这也导致了没法引用 ES6 模块本身，因为它不是对象。</p>
<p>模块功能主要由两个命令构成：<code>export</code> 和 <code>import</code>。export命令用于规定模块的对外接口，import命令用于输入其他模块提供的功能。</p>
<p>对于 <code>math.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> func1 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'func1'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> varA = <span class="string">'varA'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> defaultFunc = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'defaultFunc'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  func1,</span><br><span class="line">  varA</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> varB = <span class="string">'varB'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> func2 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'func2'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defaultFunc</span><br></pre></td></tr></table></figure>

<p>在 <code>main.js</code> 可以这么引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; func1, func2, varA, varB &#125; <span class="keyword">from</span> <span class="string">'./utils/string'</span></span><br><span class="line"><span class="keyword">import</span> defaultFunc <span class="keyword">from</span> <span class="string">'./utils/string'</span></span><br><span class="line"></span><br><span class="line">func1()</span><br><span class="line">func2()</span><br><span class="line">defaultFunc()</span><br><span class="line"><span class="built_in">console</span>.log(varA)</span><br><span class="line"><span class="built_in">console</span>.log(varB)</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/06/2019-08-06-nodejs-异步编程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="嘿嘿嘿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://s2.ax1x.com/2019/08/14/mFInYj.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/06/2019-08-06-nodejs-异步编程/" itemprop="url">nodejs-异步编程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-06T00:00:00+08:00">
                2018-10-06
              </time>
            

            

            
          </span>

          

          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  92
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="异步编程"><a href="#异步编程" class="headerlink" title="异步编程"></a>异步编程</h2><h3 id="callback瀑布级回调"><a href="#callback瀑布级回调" class="headerlink" title="callback瀑布级回调"></a>callback瀑布级回调</h3><h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><h3 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h3><h3 id="Async-和-Await"><a href="#Async-和-Await" class="headerlink" title="Async 和 Await"></a>Async 和 Await</h3><ul>
<li><p>在函数体前通过关键字async可以将函数变为async函数</p>
</li>
<li><p>在async函数中对需要异步执行的函数前需加await关键字</p>
</li>
<li><p>await后的函数必须使用Promise对象封装</p>
</li>
<li><p>async函数执行后返回的是一个Promise对象</p>
</li>
</ul>
<h2 id="NodeJs单线程是怎么保证效率的"><a href="#NodeJs单线程是怎么保证效率的" class="headerlink" title="NodeJs单线程是怎么保证效率的"></a>NodeJs单线程是怎么保证效率的</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/06/2018-10-06-Ethereum-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="嘿嘿嘿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://s2.ax1x.com/2019/08/14/mFInYj.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/06/2018-10-06-Ethereum-1/" itemprop="url">以太坊</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-06T00:00:00+08:00">
                2018-10-06
              </time>
            

            

            
          </span>

          

          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  11
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="什么是以太坊"><a href="#什么是以太坊" class="headerlink" title="什么是以太坊"></a>什么是以太坊</h2><p>简单来说，以太坊就是一个基于交易的状态机。什么是状态机呢？可以将其理解成一台机器，这台机器维护着一些状态，在以太坊交易发生时，这些状态会从一个状态转化到另一个状态。以太坊时基于区块链构建的，区块链上保存着状态和交易。当我们与以太坊交互时，其实就是在执行交易、改变系统状态。</p>
<p>引用一个公式表示就是：</p>
<blockquote>
<p>σ′ =Υ(σ,T)</p>
</blockquote>
<p>Υ是状态转换函数，T是交易，σ是状态，σ′转换后的状态。</p>
<p>从创世区块开始，无尽的交易不断的刷新着系统当前状态，每产生一个区块就对当前状态做一次快照（patricia trie根）存入区块头中。</p>
<h2 id="以太坊可以干什么？"><a href="#以太坊可以干什么？" class="headerlink" title="以太坊可以干什么？"></a>以太坊可以干什么？</h2><p>以太坊作为一个开发的区块链平台，它允许任何人在平台中建立和使用通过区块链技术运行的去中心化应用。可将之类比为Internet平台，而我们可以在其上面开发web网站。（但是似乎在以太坊上面只能开发智能合约？）</p>
<h2 id="什么是智能合约？"><a href="#什么是智能合约？" class="headerlink" title="什么是智能合约？"></a>什么是智能合约？</h2><p>智能合约就是以太坊平台上运行的程序。一旦事件触发合约中的条款，代码自动执行。智能合约的功能是由开发者自行设计的。</p>
<h3 id="智能合约的工作原理"><a href="#智能合约的工作原理" class="headerlink" title="智能合约的工作原理"></a>智能合约的工作原理</h3><p>构建 → 存储 → 执行</p>
<ol>
<li><p>智能合约由区块链内的多个用户共同参与制定，可用于用户之间的任何交易行为。协议中明确了双方的权利和义务，开发人员将这些权利和义务以电子化的方式进行编程，<strong>代码中包含会触发合约自动执行的条件</strong>。比方说，你把一套闲置的房子租给A，那么，这份智能租约中就规定了A必须在每月5号之前给你打房租、你必须在收到房租时马上给对方钥匙［2］等条款。</p>
</li>
<li><p>一旦编码完成，这份智能合约就被上传到区块链网络上，即全网验证节点都会接收到你和A的租房合约。</p>
</li>
<li><p>智能合约会定期检查是否存在 <strong>相关事件和触发条件</strong>；满足条件的事件将会推送到待验证的队列中。假设A在4号提前打房租给你，这个事件就成了该合约的触发条件（每月5号以前）。</p>
</li>
<li><p>区块链上的验证节点先对该 <strong>事件进行签名验证</strong> 以确保其有效性；等大多数验证节点对该事件达成共识后，智能合约将成功执行，并通知用户。</p>
</li>
<li><p>成功执行的合约将移出区块。而未执行的合约则继续等待下一轮处理，直至成功执行。</p>
</li>
</ol>
<p>部署到以太坊上的智能合约是要消耗以太币的。就好像把现实中的仲裁人、法官、执行人搬到了区块链上，尽管他们成了一行行的代码，但也是珍贵的计算机资源。智能合约也遵循“Less is more”，逻辑应尽可能地简单。逻辑越复杂，消耗的以太币就越多。</p>
<p>既然执行要消费以太币，如何支付呢？智能合约是预支付，为了合约顺利执行，一般提前多打一点以太币。如果预支付的以太币不足以支撑整个执行过程，就算进行到半路，合约也会回到初始状态；并且消耗的以太币也不会退回给合约发起人。</p>
<h3 id="如何触发智能合约？"><a href="#如何触发智能合约？" class="headerlink" title="如何触发智能合约？"></a>如何触发智能合约？</h3><p>智能合约本身规定了触发的条件，只要满足了条件的情况下，合约就会自动触发（比如时间到了自动缴房租）。也可以由外部账户触发。</p>
<h2 id="以太坊的区块结构"><a href="#以太坊的区块结构" class="headerlink" title="以太坊的区块结构"></a>以太坊的区块结构</h2><p>区块链上最重要的结构莫过于区块的结构，以太坊的区块结构和区块链的类似，但是又有着诸多不同。</p>
<p>以太坊区块是由三大部分组成：区块头，叔块，交易列表。</p>
<ul>
<li><p>区块头由15个字段组成。</p>
</li>
<li><p>叔块其实就是孤块，是由于某个区块上产生了多分支。因以太坊出块速度很快平均十几秒就会打包生成一个块，所以矿工挖矿的竞争性很高，可能同时产出几个都合法的区块，以太坊为了一些安全性起见，允许竞争块也挂在到主链上，同时给与挖出这些孤块的矿工们少许奖励增加工作的公平性。这些孤块最多允许6个高度，这也是6个区块确认主链说法的来源。</p>
</li>
<li><p>交易列表，存储的是本区块中所有的交易内容。</p>
</li>
</ul>
<p>看一下一个实际的区块信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&quot;blocks&quot; : [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;blockHeader&quot; : &#123;</span><br><span class="line">                    &quot;bloom&quot; : &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,</span><br><span class="line">                    &quot;coinbase&quot; : &quot;0x3535353535353535353535353535353535353535&quot;,</span><br><span class="line">                    &quot;difficulty&quot; : &quot;0x020000&quot;,</span><br><span class="line">                    &quot;extraData&quot; : &quot;&quot;,</span><br><span class="line">                    &quot;gasLimit&quot; : &quot;0x05f5e100&quot;,</span><br><span class="line">                    &quot;gasUsed&quot; : &quot;0x014fa1&quot;,</span><br><span class="line">                    &quot;hash&quot; : &quot;0x39f4659b079e257df8fd7e699528531e97a6b8a442ca0d11200c4a2f7433c483&quot;,</span><br><span class="line">                    &quot;mixHash&quot; : &quot;0x7379f33af4ae2db7e293f808a165135d0b1a99572cc96fb9f7d17ef64a751969&quot;,</span><br><span class="line">                    &quot;nonce&quot; : &quot;0x8e08d7aabeee8773&quot;,</span><br><span class="line">                    &quot;number&quot; : &quot;0x01&quot;,</span><br><span class="line">                    &quot;parentHash&quot; : &quot;0xadbef3bf0b3b7b14f6e7b1a45d240ecc863543a279a86c23f60170e8e7a6bcc3&quot;,</span><br><span class="line">                    &quot;receiptTrie&quot; : &quot;0xb21660268480338c0cd0613358315359b619bd527d5850949c4863cddaec316b&quot;,</span><br><span class="line">                    &quot;stateRoot&quot; : &quot;0xde4ce9b5b2f88ab1680962c64281224b1743bdf94bd6a9e390ea779ff616c1f7&quot;,</span><br><span class="line">                    &quot;timestamp&quot; : &quot;0x03e8&quot;,</span><br><span class="line">                    &quot;transactionsTrie&quot; : &quot;0x56445ba866f3e41851154fb8700dcec8556a178f1833021e030b8a47b494769d&quot;,</span><br><span class="line">                    &quot;uncleHash&quot; : &quot;0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;rlp&quot; : &quot;0xf90308f901f9a0adbef3bf0b3b7b14f6e7b1a45d240ecc863543a279a86c23f60170e8e7a6bcc3a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347943535353535353535353535353535353535353535a0de4ce9b5b2f88ab1680962c64281224b1743bdf94bd6a9e390ea779ff616c1f7a056445ba866f3e41851154fb8700dcec8556a178f1833021e030b8a47b494769da0b21660268480338c0cd0613358315359b619bd527d5850949c4863cddaec316bb901000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000083020000018405f5e10083014fa18203e880a07379f33af4ae2db7e293f808a165135d0b1a99572cc96fb9f7d17ef64a751969888e08d7aabeee8773f90108f90105460183030d4094c305c901078781c232a2a521c2af7980f8385ee980b8a430c8d1da000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000230644e72e131a029b85045b68181585d2833e84879b9709143e1f593f00000001ba021a28cc82b40931239f8653ffa5300e1a506c0ef7fb79a663772cafe6558ab44a075af23441f7f176a2770af41142c77b671391209b15d59144e7a1332179b5e14c0&quot;,</span><br><span class="line">                &quot;transactions&quot; : [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;data&quot; : &quot;0x30c8d1da000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000230644e72e131a029b85045b68181585d2833e84879b9709143e1f593f0000000&quot;,</span><br><span class="line">                        &quot;gasLimit&quot; : &quot;0x030d40&quot;,</span><br><span class="line">                        &quot;gasPrice&quot; : &quot;0x01&quot;,</span><br><span class="line">                        &quot;nonce&quot; : &quot;0x46&quot;,</span><br><span class="line">                        &quot;r&quot; : &quot;0x21a28cc82b40931239f8653ffa5300e1a506c0ef7fb79a663772cafe6558ab44&quot;,</span><br><span class="line">                        &quot;s&quot; : &quot;0x75af23441f7f176a2770af41142c77b671391209b15d59144e7a1332179b5e14&quot;,</span><br><span class="line">                        &quot;to&quot; : &quot;0xc305c901078781c232a2a521c2af7980f8385ee9&quot;,</span><br><span class="line">                        &quot;v&quot; : &quot;0x1b&quot;,</span><br><span class="line">                        &quot;value&quot; : &quot;0x00&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                &quot;uncleHeaders&quot; : [</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br></pre></td></tr></table></figure>

<h3 id="区块头的结构"><a href="#区块头的结构" class="headerlink" title="区块头的结构"></a>区块头的结构</h3><p>区块头包含15个字段，介绍如下：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Header <span class="keyword">struct</span> &#123;</span><br><span class="line">        ParentHash  common.Hash    <span class="comment">//Hp，上一区块全部内容的hash，区块因它而成链！</span></span><br><span class="line">        UncleHash   common.Hash    <span class="comment">//Ho，本区块的ommers（所有叔块）列表的hash</span></span><br><span class="line">        Coinbase    common.Address <span class="comment">//Hc，成功挖出本区块的矿工地址，用于接收矿工费</span></span><br><span class="line">        Root        common.Hash    <span class="comment">//Hr，本区块所有交易的状态tree的根hash</span></span><br><span class="line">        TxHash      common.Hash    <span class="comment">//Ht，本区块所有交易tree的根hash</span></span><br><span class="line">        ReceiptHash common.Hash    <span class="comment">//He，本区块所有交易的收据的tree的根hash</span></span><br><span class="line">        Bloom       Bloom          <span class="comment">//Hb，交易收据日志组成的Bloom过滤器 </span></span><br><span class="line">        Difficulty  *big.Int       <span class="comment">//Hd，本区块难度级别</span></span><br><span class="line">        Number      *big.Int       <span class="comment">//Hi，区块序号，从创世块0递增</span></span><br><span class="line">        GasLimit    <span class="keyword">uint64</span>         <span class="comment">//Hl，每个区块当前的gas limit</span></span><br><span class="line">        GasUsed     <span class="keyword">uint64</span>         <span class="comment">//Hg，本区块交易消耗的总gas</span></span><br><span class="line">        Time        *big.Int       <span class="comment">//Hs，本区块创建时的Unix时间戳</span></span><br><span class="line">        Extra       []<span class="keyword">byte</span>         <span class="comment">//Hx，区块附加数据，&lt;=32字节</span></span><br><span class="line">        MixDigest   common.Hash    <span class="comment">//Hm，256位的hash，与nonce组合证明出块执行了足够的计算</span></span><br><span class="line">        Nonce       BlockNonce     <span class="comment">//Hn，64位的hash，与MixDigest组合证明出块执行了足够的计算</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有三个特别的字段保存的是patricia trie树的hash值，Root（状态hash）、TxHash（交易列表hash）、ReceiptHash(收据列表hash)。这个Root就是系统状态hash。系统状态就是以太坊整个网络中所有账户的状态，就是world state，它是一个merkle patricia trie结构。这个树（包括所有patricia trie）并不存在于区块，而存在于节点的levelDB中。只有它的根hash存在于区块头Root中，每一个区块头里的Root都是区块被挖出确认时的快照，而world state指现在所有账户的状态。</p>
<h3 id="什么是-world-state？"><a href="#什么是-world-state？" class="headerlink" title="什么是 world state？"></a>什么是 world state？</h3><p>world state是一颗全局状态树，被存储在每个节点的levelDB里，它被持续地更新。这棵树包含了以太坊网络里每一个账户的key/value映射。所以它表示的是整个以太坊系统所有账户当前的状态。树的一个叶子节点是一个key/value映射，key是KEC(a)即160位的账户地址的哈希，value是账户（nonce、balance、storageRoot、codeHash）的RLP格式序列化字节。</p>
<h3 id="什么是账户？"><a href="#什么是账户？" class="headerlink" title="什么是账户？"></a>什么是账户？</h3><p>以太坊中有两种账户</p>
<ul>
<li><p>外部拥有账户（EOA），一般指自然人拥有的账户。</p>
</li>
<li><p>合约账户（CA），为智能合约分配的账户。</p>
</li>
</ul>
<p>看一下账户的源码定义：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Account <span class="keyword">struct</span> &#123;</span><br><span class="line">    Nonce    <span class="keyword">uint64</span>      <span class="comment">// 若为EOA是发送的交易序号，如为CA是合约创建的序号。</span></span><br><span class="line">    Balance  *big.Int    <span class="comment">// 这个地址的余额。</span></span><br><span class="line">    Root     common.Hash <span class="comment">// 账户自身内容RPL编码组成的Merkle Trie的根哈希</span></span><br><span class="line">    CodeHash []<span class="keyword">byte</span>      <span class="comment">// 账户绑定的EVM Code，账户一经创建不可修改。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>EOA特征：</p>
<ul>
<li><p>codeHash为空</p>
</li>
<li><p>storageRoot为空</p>
</li>
<li><p>通过私钥控制</p>
</li>
<li><p>发起交易（转移以太币或触发合约代码）</p>
</li>
</ul>
<p>CA特征：</p>
<ul>
<li><p>不能主动发起交易</p>
</li>
<li><p>可以被触发执行合约代码（通过EOA发起的交易或者从其他CA接收的消息调用激活）<br>怎么判断一个账户是空账户？</p>
</li>
</ul>
<h3 id="交易"><a href="#交易" class="headerlink" title="交易"></a>交易</h3><p>以太坊是一个基于交易的状态机。任意两个账户之间的交易都会引起world state的改变。</p>
<p>交易基本定义：【从外部拥有账户】发送的加密签名序列化指令。换句话说交易必须是从EOA发起的才能叫交易，CA之间的通信叫消息也有叫内部交易的。</p>
<p>交易类型有两种：</p>
<ul>
<li><p>消息调用（Td）</p>
</li>
<li><p>合约创建（Ti）</p>
</li>
</ul>
<p>从EOA到EOA的交易仅是转账，EOA到CA可以激活各种操作。</p>
<p>存储交易数据的结构体：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> txdata <span class="keyword">struct</span> &#123;</span><br><span class="line">    AccountNonce <span class="keyword">uint64</span>          <span class="comment">//Tn</span></span><br><span class="line">    Price        *big.Int        <span class="comment">//Tp</span></span><br><span class="line">    GasLimit     <span class="keyword">uint64</span>          <span class="comment">//Tg</span></span><br><span class="line">    Recipient    *common.Address <span class="comment">//Tt</span></span><br><span class="line">    Amount       *big.Int        <span class="comment">//Tv</span></span><br><span class="line">    Payload      []<span class="keyword">byte</span>          <span class="comment">//Td || Ti </span></span><br><span class="line">    V *big.Int</span><br><span class="line">    R *big.Int</span><br><span class="line">    S *big.Int</span><br><span class="line">    <span class="comment">// This is only used when marshaling to JSON.</span></span><br><span class="line">    Hash *common.Hash</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Tn必须等于发起交易的账户的nonce（翻阅前面说法可知，账户nonce是该账户发起的第几笔交易的序号，如果是创建合约则代表第几次创建合约的序号）</p>
</li>
<li><p>Tp是这笔交易消耗的gas单价</p>
</li>
<li><p>Tg是你愿意为这笔交易最多可以支付的上限</p>
</li>
<li><p>Tt是接收账户的地址，如果为空说明接受账户是一个CA，否则是EOA</p>
</li>
<li><p>Tv是到接收者的额度</p>
</li>
<li><p>Td或Ti，如果交易类型是消息调用则Payload写为Td，表示输入数据，例如消息的参数，假设有一个注册域名的合约服务，则Td就是该服务需要的参数如IP等。如果交易类型是创建合约，则Payload写为Ti，表示一段代码，这段代码用于创建合约账户，这段初始化代码只会被执行一次就丢弃掉，第二次执行的是创建完的合约代码体。</p>
</li>
</ul>
<h3 id="什么是费用？"><a href="#什么是费用？" class="headerlink" title="什么是费用？"></a>什么是费用？</h3><p>以太坊网络里任何计算都要支付gas（燃料），为什么不直接用eth做费用呢？答案是用两个概念gas和eth区别价值和价格，gas是一种固定衡量的价值，而eth是市场上快速变化的价格，很多EVM（以太坊虚拟机）的操作指令都需要消耗固定的费用就用gas来计价，gas的最小单位是wei，1eth = 1018wei = 109gwei。所以eth和gas之间是有汇率的。</p>
<blockquote>
<p>GasPrice：燃料单价<br>GasLimit：愿意支付的燃料上限<br>GasLimit × GasPrice = 愿意支付的最大费用</p>
</blockquote>
<p>一笔交易中，你设置的最大费用如果没有消耗完，多出的会返回给你。如果最大费用不够计算的花费，那么交易会终止、已改变的状态会回滚、但是钱被消耗不会退回了。这些已消耗的费用都奖励给矿工了。</p>
<p>费用的三种不同构成：</p>
<ul>
<li><p>计算操作的固定费用</p>
</li>
<li><p>交易（合约创建或消息调用）费用</p>
</li>
<li><p>存储（内存、存储账户合约数据）费用</p>
</li>
</ul>
<p>存储收费是因为假如你的合约使得状态数据库存储增大，所有节点都会增加存储。以太币是鼓励尽量保持少量存储的。<br>但是如果有操作是清除一个存储条目，这个操作的费用不但会被免除，而且由于释放空间还会获得退款。</p>
<h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h2><h3 id="什么是RLP编码？"><a href="#什么是RLP编码？" class="headerlink" title="什么是RLP编码？"></a>什么是RLP编码？</h3><h3 id="什么是Patricia-Trie？"><a href="#什么是Patricia-Trie？" class="headerlink" title="什么是Patricia Trie？"></a>什么是Patricia Trie？</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/05/2018-10-05-blockchain-tx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="嘿嘿嘿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://s2.ax1x.com/2019/08/14/mFInYj.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/05/2018-10-05-blockchain-tx/" itemprop="url">区块链的运转流程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-05T00:00:00+08:00">
                2018-10-05
              </time>
            

            

            
          </span>

          

          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.7k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  5
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="区块链的运转流程"><a href="#区块链的运转流程" class="headerlink" title="区块链的运转流程"></a>区块链的运转流程</h2><p>当一笔交易经由某个节点或钱包产生时，这笔交易需要被转播给其他的节点来做验证。</p>
<ol>
<li><p>产生一笔新交易</p>
<p> 一笔新交易产生时，会被广播到区块链中的其他参与节点</p>
</li>
<li><p>各节点将多笔交易一起放进区块</p>
<p> 每个节点会将数笔未验证的交易的hash值收集到区块中，每个区块可以包含数百笔或上千笔交易</p>
</li>
<li><p>决定由谁来打包区块</p>
<p> 各个节点进行POW，来决定谁可以获得区块的打包权，由最快算出结果的节点打包该区块</p>
</li>
<li><p>各节点验证打包的区块</p>
<p> 其他节点会确认这个区块所包含的交易是否有效，确认没被重复花费且具有有效数位签章后，接受该区块，此时该区块才能正式接上区块链</p>
</li>
<li><p>交易验证完成</p>
<p> 所有节点一旦接受该区块后，先前没计算完POW工作的区块将会失效，各节点会重新建立一个区块，并开始下一轮POW计算工作</p>
</li>
</ol>
<h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h2><h3 id="节点如何验证某个区块的有效性？"><a href="#节点如何验证某个区块的有效性？" class="headerlink" title="节点如何验证某个区块的有效性？"></a>节点如何验证某个区块的有效性？</h3><p>当某个节点收到某个区块后，需要验证的信息有三个：</p>
<ul>
<li><p>区块编号有效</p>
<p>  对区块的header进行2次hash计算，计算出来的值就是当前区块的hash值</p>
</li>
<li><p>区块的上一个区块hash值有效</p>
<p>  对比区块里的上一个区块hash值和当前节点区块链里的最后一个区块的编号（每个节点都有着一条完整的区块链数据），如果相同则验证通过，如果不同，需要顺着已有链往前查找，直到找到这个编号的页（找到了又怎么样呢？这就代表上一个区块后面已经有别的区块链啊？？？这就形成了多分支了）。如果没有找到，则验证不通过。</p>
</li>
<li><p>交易清单有效</p>
<p>  这里即是确认每笔交易的付款人是否有足够的余额来支付这笔钱。确认交易输入的UTXO是否存在，且在此之前没有支付给别人，另外，产生交易的节点本身并不验证交易输入的UTXO是否有效，即不验证交易输出用户的余额是否充足，余额的验证是让其他节点来做的</p>
</li>
</ul>
<h3 id="当节点收到一笔新交易时，是否会立即开始打包成区块的操作？"><a href="#当节点收到一笔新交易时，是否会立即开始打包成区块的操作？" class="headerlink" title="当节点收到一笔新交易时，是否会立即开始打包成区块的操作？"></a>当节点收到一笔新交易时，是否会立即开始打包成区块的操作？</h3><p>矿工是一直在收集交易信息的，但只有等到上一个区块生成后，拿到上一个区块的hash值时，才会将收集到的交易信息打包新的区块，并进行POW工作</p>
<h3 id="当一个区块发现它的上一个区块已经连接上了新的区块后，如何处理？"><a href="#当一个区块发现它的上一个区块已经连接上了新的区块后，如何处理？" class="headerlink" title="当一个区块发现它的上一个区块已经连接上了新的区块后，如何处理？"></a>当一个区块发现它的上一个区块已经连接上了新的区块后，如何处理？</h3><p>这就是区块链的多分支问题，当矿工收到两份不一样的区块，它们都基于当前这个矿工节点的链上的最后一个节点，并且内容都合法，都应将其保留，按分支的形式组织起来。区块链规定，任何时刻，都以最长的链作为主链，当某个分支的长度长于另外的分支后，该分支就称为主分支了，其他分支就会被遗忘。</p>
<h3 id="由于多分支问题产生的双花问题该如何解决？"><a href="#由于多分支问题产生的双花问题该如何解决？" class="headerlink" title="由于多分支问题产生的双花问题该如何解决？"></a>由于多分支问题产生的双花问题该如何解决？</h3><p>中本聪给出的解决方案是，建议收款人不要在公告挂出时立即确认交易完成，而是应该再看一段时间，等待各个挖矿小组再挂出6张确认账簿，并且之前的账簿没有被取消，才确认钱已到账。</p>
<p>中本聪解释道，之前设定变态的编号规则，正是为了防御这一点。根据前面所述，生成有效账簿页不是那么简单的，要花费大量的人力反复试不同的幸运数 字，而且过程完全是碰运气。如果某账簿页包含你收到钱的确认，并且在后面又延续了6个，那么攻击者想要在落后6页的情况下从另一个分支赶超当前主分支是非 常困难的，除非攻击者拥有非常多的人力，超过其他所有诚实矿工的人力之和。</p>
<p>而且，如果攻击者有如此多人力，与其花这么大力气搞这种攻击，还不如做良民挖矿来的收益大。这就从动机上杜绝了攻击的形成。</p>
<h3 id="每个节点打包到区块里的交易都是一样的吗？"><a href="#每个节点打包到区块里的交易都是一样的吗？" class="headerlink" title="每个节点打包到区块里的交易都是一样的吗？"></a>每个节点打包到区块里的交易都是一样的吗？</h3><p>区块的打包是由矿工来做的，矿工可能是随机地选取某几笔交易进行打包，也可能是挑选交易手续费较高的交易进行打包，因此，每个节点产生的区块是不一样的。</p>
<h3 id="如果各个节点打包的区块交易是完全不同的，那会怎么样？"><a href="#如果各个节点打包的区块交易是完全不同的，那会怎么样？" class="headerlink" title="如果各个节点打包的区块交易是完全不同的，那会怎么样？"></a>如果各个节点打包的区块交易是完全不同的，那会怎么样？</h3><p>比如，节点A打包了一个区块，所含的交易是1和2；节点B也打包了一个区块，所含的交易是3和4；由于两个节点打包的区块的前驱节点都是一致的，如果这两个区块都合法，且都被其他节点验证通过了，那么就会在链上形成分支。</p>
<h3 id="当一个节点完成POW工作后，广播给其他节点验证时，如果有某个节点此时在进行着其他交易（即不包含相同的交易）的POW工作，会怎么样？"><a href="#当一个节点完成POW工作后，广播给其他节点验证时，如果有某个节点此时在进行着其他交易（即不包含相同的交易）的POW工作，会怎么样？" class="headerlink" title="当一个节点完成POW工作后，广播给其他节点验证时，如果有某个节点此时在进行着其他交易（即不包含相同的交易）的POW工作，会怎么样？"></a>当一个节点完成POW工作后，广播给其他节点验证时，如果有某个节点此时在进行着其他交易（即不包含相同的交易）的POW工作，会怎么样？</h3><p>会停止当前工作，先验证区块的有效性</p>
<h3 id="矿工是不间断地进行挖矿工作的吗？可以光挖矿而不打包普通交易吗？"><a href="#矿工是不间断地进行挖矿工作的吗？可以光挖矿而不打包普通交易吗？" class="headerlink" title="矿工是不间断地进行挖矿工作的吗？可以光挖矿而不打包普通交易吗？"></a>矿工是不间断地进行挖矿工作的吗？可以光挖矿而不打包普通交易吗？</h3><p>矿工基本上就是在不间断地做POW工作的，矿工的收入主要来源于挖矿和手续费。一般来说，币的数量是有限的，前期矿工应该可以只挖矿，但为了获得更大的收益，都会选择打包有手续费的交易</p>
<h3 id="产生一笔交易的时候，就会产生一个区块吗？"><a href="#产生一笔交易的时候，就会产生一个区块吗？" class="headerlink" title="产生一笔交易的时候，就会产生一个区块吗？"></a>产生一笔交易的时候，就会产生一个区块吗？</h3><p>并不是，收集多少笔交易之后开始打包成区块，是由挖矿策略或者挖矿程序决定的。</p>
<h3 id="是否有可能区块生成时，块里没有交易数据？"><a href="#是否有可能区块生成时，块里没有交易数据？" class="headerlink" title="是否有可能区块生成时，块里没有交易数据？"></a>是否有可能区块生成时，块里没有交易数据？</h3><p>可能存在区块里有零笔普通交易，但有一个系统给予的挖矿奖励的交易。对于空交易的区块，由于数量量小，算出满足条件的区块hash值更快。据说早期的区块大都是这种。系统给予奖励，矿工们才有挖矿的热情。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://s2.ax1x.com/2019/08/14/mFInYj.jpg" alt="嘿嘿嘿">
            
              <p class="site-author-name" itemprop="name">嘿嘿嘿</p>
              <p class="site-description motion-element" itemprop="description">记录打怪升级之路</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yourname" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:yourname@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">嘿嘿嘿</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
